<template>
    <div class="authorization">
        <div class="authorization__left">
            <div class="authorization__top">
                <div class="authorization__logo">
                    <svg width="138" height="48" viewBox="0 0 138 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M66.9427 19.6823C67.9909 19.6823 68.9098 19.8995 69.6993 20.334C70.4889 20.7549 71.0947 21.3523 71.5167 22.1263C71.9523 22.9002 72.1701 23.7963 72.1701 24.8147C72.1701 25.8601 71.9115 26.7902 71.3942 27.6049C70.8905 28.406 70.1826 29.0305 69.2705 29.4786C68.3584 29.9131 67.3238 30.1303 66.1667 30.1303C64.2473 30.1303 62.7362 29.5193 61.6336 28.2974C60.5445 27.0618 60 25.2559 60 22.8798C60 20.6802 60.4765 18.9287 61.4294 17.6253C62.3959 16.3082 63.8729 15.446 65.8604 15.0387L71.0879 14L71.5167 16.7291L66.9018 17.6456C65.6494 17.89 64.7169 18.2974 64.1043 18.8676C63.5054 19.4379 63.1514 20.2458 63.0425 21.2912C63.519 20.7753 64.0907 20.3815 64.7578 20.11C65.4248 19.8248 66.1531 19.6823 66.9427 19.6823ZM66.1872 27.666C67.0039 27.666 67.6574 27.4012 68.1474 26.8717C68.6511 26.3422 68.903 25.6701 68.903 24.8554C68.903 24.0272 68.6511 23.3686 68.1474 22.8798C67.6574 22.391 67.0039 22.1466 66.1872 22.1466C65.3568 22.1466 64.6897 22.391 64.186 22.8798C63.6823 23.3686 63.4305 24.0272 63.4305 24.8554C63.4305 25.6836 63.6891 26.3625 64.2064 26.8921C64.7237 27.408 65.384 27.666 66.1872 27.666Z" fill="white"/>
                    <path d="M85.6512 18.9287L80.6892 30.558C80.1856 31.8208 79.5594 32.7101 78.8106 33.2261C78.0755 33.742 77.1839 34 76.1357 34C75.5639 34 74.999 33.9117 74.4408 33.7352C73.8827 33.5587 73.4267 33.3143 73.0727 33.002L74.2366 30.7413C74.4817 30.9586 74.7607 31.1283 75.0738 31.2505C75.4006 31.3727 75.7205 31.4338 76.0336 31.4338C76.4692 31.4338 76.8231 31.3252 77.0954 31.1079C77.3676 30.9043 77.6127 30.558 77.8305 30.0692L77.8713 29.9674L73.1136 18.9287H76.4011L79.4845 26.3625L82.5883 18.9287H85.6512Z" fill="white"/>
                    <path d="M94.0713 19.6823C95.1195 19.6823 96.0384 19.8995 96.8279 20.334C97.6175 20.7549 98.2233 21.3523 98.6453 22.1263C99.0809 22.9002 99.2987 23.7963 99.2987 24.8147C99.2987 25.8601 99.0401 26.7902 98.5228 27.6049C98.0191 28.406 97.3112 29.0305 96.3991 29.4786C95.487 29.9131 94.4525 30.1303 93.2953 30.1303C91.3759 30.1303 89.8648 29.5193 88.7622 28.2974C87.6731 27.0618 87.1286 25.2559 87.1286 22.8798C87.1286 20.6802 87.6051 18.9287 88.558 17.6253C89.5245 16.3082 91.0015 15.446 92.989 15.0387L98.2165 14L98.6453 16.7291L94.0304 17.6456C92.778 17.89 91.8455 18.2974 91.233 18.8676C90.634 19.4379 90.28 20.2458 90.1711 21.2912C90.6476 20.7753 91.2193 20.3815 91.8864 20.11C92.5534 19.8248 93.2817 19.6823 94.0713 19.6823ZM93.3158 27.666C94.1325 27.666 94.786 27.4012 95.276 26.8717C95.7797 26.3422 96.0316 25.6701 96.0316 24.8554C96.0316 24.0272 95.7797 23.3686 95.276 22.8798C94.786 22.391 94.1325 22.1466 93.3158 22.1466C92.4854 22.1466 91.8183 22.391 91.3146 22.8798C90.811 23.3686 90.5591 24.0272 90.5591 24.8554C90.5591 25.6836 90.8178 26.3625 91.3351 26.8921C91.8524 27.408 92.5126 27.666 93.3158 27.666Z" fill="white"/>
                    <path d="M112.78 18.9287L107.818 30.558C107.314 31.8208 106.688 32.7101 105.939 33.2261C105.204 33.742 104.312 34 103.264 34C102.693 34 102.128 33.9117 101.569 33.7352C101.011 33.5587 100.555 33.3143 100.201 33.002L101.365 30.7413C101.61 30.9586 101.889 31.1283 102.202 31.2505C102.529 31.3727 102.849 31.4338 103.162 31.4338C103.598 31.4338 103.952 31.3252 104.224 31.1079C104.496 30.9043 104.741 30.558 104.959 30.0692L105 29.9674L100.242 18.9287H103.53L106.613 26.3625L109.717 18.9287H112.78Z" fill="white"/>
                    <path d="M119.769 25.7312H118.115V29.8859H114.929V18.9287H118.115V23.1853H119.83L122.811 18.9287H126.201L122.362 24.1833L126.466 29.8859H122.709L119.769 25.7312Z" fill="white"/>
                    <path d="M132.711 18.7658C134.413 18.7658 135.72 19.1731 136.632 19.9878C137.544 20.7889 138 22.0041 138 23.6334V29.8859H135.019V28.5214C134.42 29.5397 133.303 30.0489 131.67 30.0489C130.826 30.0489 130.091 29.9063 129.465 29.6212C128.852 29.336 128.382 28.9423 128.056 28.4399C127.729 27.9375 127.566 27.3673 127.566 26.7291C127.566 25.7108 127.947 24.9097 128.709 24.3259C129.485 23.742 130.676 23.4501 132.282 23.4501H134.815C134.815 22.7576 134.604 22.2281 134.182 21.8615C133.76 21.4813 133.127 21.2912 132.282 21.2912C131.697 21.2912 131.119 21.3863 130.547 21.5764C129.989 21.7529 129.512 21.9973 129.117 22.3096L127.974 20.0896C128.573 19.6687 129.288 19.3428 130.118 19.112C130.962 18.8812 131.826 18.7658 132.711 18.7658ZM132.466 27.9104C133.011 27.9104 133.494 27.7882 133.916 27.5438C134.338 27.2858 134.638 26.9124 134.815 26.4236V25.3035H132.63C131.323 25.3035 130.669 25.7312 130.669 26.5866C130.669 26.9939 130.826 27.3198 131.139 27.5642C131.466 27.795 131.908 27.9104 132.466 27.9104Z" fill="white"/>
                    <circle cx="24" cy="24" r="24" fill="#FB7700"/>
                    <path d="M18.8809 34.8899C22.128 24.5602 31.526 22.5482 35.8191 22.8334C38.1295 28.6205 35.3247 32.8675 33.6335 34.2676C28.2632 39.8681 21.5608 37.016 18.8809 34.8899Z" fill="white"/>
                    <path d="M14.8867 27.3735C17.7682 15.7721 26.0911 17.0286 30.3842 17.3138C41.7803 24.9723 30.7347 21.1304 24.9718 26.413C18.2484 34.5772 14.8867 44.182 14.8867 27.3735Z" fill="#FB7700"/>
                    <path d="M25.2002 20.969C27.8057 21.1616 30.0754 19.2027 30.2696 16.5937C30.4638 13.9846 28.509 11.7135 25.9035 11.5209C23.2979 11.3283 21.0283 13.2872 20.8341 15.8962C20.8318 15.9264 20.8298 15.9566 20.8282 15.9867C20.3366 15.3896 19.6116 14.9868 18.7798 14.9254C17.1626 14.8058 15.7538 16.0217 15.6333 17.6411C15.5127 19.2605 16.726 20.6702 18.3433 20.7897C19.7982 20.8973 21.0845 19.9239 21.4157 18.5483C22.1638 19.8933 23.5517 20.8471 25.2002 20.969Z" fill="white"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M31.1928 16.8908C31.2064 16.732 31.2134 16.5713 31.2134 16.409C31.2134 13.3426 28.7225 10.8545 25.6469 10.8545C23.1737 10.8545 21.0789 12.463 20.3529 14.6878C19.7594 14.3351 19.0654 14.132 18.3239 14.132C17.5645 14.132 16.855 14.3446 16.252 14.7134C13.9538 16.1188 13.733 20.0301 15.9144 21.6107C13.7892 25.1869 12.7743 31.7189 16.5677 38.57L17.5478 40.3401L18.1406 38.4067C18.3718 37.6528 18.6695 36.8203 19.0397 35.9461C20.9717 37.4322 23.4418 38.39 26.0617 38.39C32.3557 38.39 37.4579 33.3056 37.4579 27.0336C37.4579 25.3874 37.1059 23.8208 36.472 22.4065C35.4013 20.0179 33.528 18.066 31.1928 16.8908ZM25.6469 12.5657C25.5896 12.5657 25.5304 12.5661 25.4698 12.5668C23.742 12.5872 21.9033 14.1688 21.2882 15.8503C21.1882 16.1237 20.9406 16.328 20.6494 16.328C20.2531 16.0029 19.4328 15.4671 18.4946 15.4671C16.9214 15.4671 16.2267 16.6477 16.2267 16.6477C16.2267 16.6477 16.4222 16.5327 17.4755 16.4549C18.5288 16.3771 19.7381 16.9294 20.6758 17.9131C20.6758 17.9131 19.2498 17.3297 17.8658 17.3333C17.8658 17.3333 17.6995 17.9434 18.3239 18.0937C18.8588 18.2224 19.2708 17.7773 19.2708 17.7773C19.2708 18.3357 18.7385 18.9206 18.178 18.9206C17.6176 18.9206 16.7952 18.4753 16.7952 17.4414C16.2267 17.5168 15.9144 17.7773 15.9144 17.7773C15.6022 19.2696 16.8987 20.4676 18.142 20.4676C20.4159 20.4676 21.1479 18.244 21.1479 18.244V17.5168C21.4767 16.7817 21.911 16.0868 22.4258 15.4667C23.5439 14.1199 25.1728 13.2595 26.9204 13.1102C24.9716 13.9268 24.5846 14.842 24.3844 14.994C24.3844 14.994 24.522 15.8503 25.3806 15.8503C26.0831 15.8503 26.3173 15.4614 26.3173 15.4614C26.3173 15.4614 26.2392 17.0721 24.6781 17.0721C24.0178 17.0721 23.4639 16.6182 23.3134 16.0064C22.6689 16.7632 22.5606 17.1186 22.2946 18.0937C22.2946 18.1263 22.3063 18.2045 22.3447 18.3173C22.375 18.4063 22.4095 18.4809 22.4298 18.5204C23.1198 19.5659 24.3035 20.2523 25.6469 20.2523C27.7715 20.2523 29.4962 18.5329 29.4962 16.409C29.4962 14.2852 27.7715 12.5657 25.6469 12.5657ZM21.6434 20.2683C21.0153 21.2209 19.2087 22.0909 17.7958 21.8401C15.9317 24.6363 14.8618 30.0608 17.1996 35.911C18.2168 33.3388 19.847 30.3239 22.258 27.7488C25.098 24.7157 29.0309 22.2874 34.2837 21.9417C33.4153 20.5524 32.2019 19.3988 30.7633 18.6006C29.9115 20.578 27.942 21.9636 25.6469 21.9636C24.0743 21.9636 22.6548 21.3125 21.6434 20.2683ZM19.781 34.3449C21.4815 35.7617 23.7171 36.6788 26.0617 36.6788C31.4073 36.6788 35.7407 32.3605 35.7407 27.0336C35.7407 25.8291 35.5195 24.6778 35.116 23.6166C30.0061 23.7462 26.2391 26.0054 23.5136 28.9163C21.9303 30.6072 20.7023 32.516 19.781 34.3449Z" fill="#202020"/>
                    <path d="M23.0629 5.76294L19.823 11.1987L23.6467 7.67329L25.2415 7.68805L23.0629 5.76294Z" fill="#202020"/>
                    <path d="M16.7586 11.1316C16.4525 10.4748 15.8818 9.93894 15.1313 9.69107C13.6945 9.21653 12.1429 9.97734 11.6658 11.3904C11.3732 12.2569 11.5526 13.1676 12.0666 13.8517C12.06 13.5255 12.1088 13.1928 12.2192 12.8658C12.7397 11.3243 14.4323 10.4943 15.9997 11.012C16.3087 11.1141 16.5898 11.2609 16.838 11.4427C16.833 11.4234 16.8276 11.4021 16.8217 11.3792L16.8083 11.3262C16.7939 11.2692 16.7773 11.2038 16.7586 11.1316Z" fill="#202020"/>
                    </svg>
                </div>
            </div>
            <div class="authorization__bottom">
                <h1 class="authorization__title">Авторизация</h1>
                <div class="authorization__form">
                    <div class="authorization__wrapper input__wrapper">
                        <transition name="fade">
                            <div v-if="form.email.error" class="input__error">
                                Неверный e-mail
                            </div>
                        </transition>
                        <input
                            v-model="form.email.value"
                            type="text"
                            class="input"
                            placeholder="Ваш e-mail"
                            :class="{'t-input__error' : form.email.error}"
                            @input="form.email.error = false; error = ''"
                        >
                    </div>
                    <div class="authorization__wrapper input__wrapper">
                        <transition name="fade">
                            <div v-if="form.password.error" class="input__error">
                                Некорректный пароль
                            </div>
                        </transition>
                        <input
                            v-model="form.password.value"
                            type="password"
                            class="input"
                            placeholder="Ваш пароль"
                            :class="{'t-input__error' : form.password.error}"
                            @input="form.password.error = false; error = ''"
                        >
                    </div>
                    <div :class="{'authorization__error_hidden': error == ''}" class="authorization__error">{{error}}</div>
                    <div class="authorization__action">
                        <div class="authorization__forgot">Забыли пароль?</div>
                        <div @click="sendForm" class="authorization__enter">Войти</div>
                    </div>
                    <div @click="toRequest" class="authorization__request">Оставить заявку</div>
                </div>
                <div class="authorization__files">
                    <a class="authorization__file" href="/src/assets/documents/Personal_data_using.pdf" target="_blank">Политика безопасности</a>
                    <a class="authorization__file" href="/src/assets/documents/Using_cookies.pdf" target="_blank">Использование файлов «Cookies»</a>
                </div>
            </div>
            
        </div>
        <div class="authorization__right">
            <img src="/src/assets/images/micro.png" alt="" class="authorization__img">
        </div>
    </div>
</template>

<script>
import Vue from 'vue'
import {mapMutations} from 'vuex';
import getTariffs from '@components/mixins/getTariffs'
export default {
    mixins: [getTariffs],
    data() {
        return {
            form: {
                email: {
                    value: 'test@bubuka.info',
                    error: ''
                },
                password: {
                    value: 'test',
                    error: ''
                }
            },
            error: ''
        }
    },
    methods: {
        ...mapMutations('modal', ['showModal']),
        ...mapMutations('auth', ['setProfile']),
        validForm () {
            let valid = true

            if (!this.form.email.value ||
                this.form.email.value === '' ||
                /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$/i.test(this.form.email.value) === false
            ) {
                this.form.email.error = true
                valid = false
            }

            if (!this.form.password.value ||
                this.form.password.value === ''
            ) {
                this.form.password.error = true
                valid = false
            }

            return valid
        },
        setProfileMethod(data) {
            let obj = {
                email: data.user.email,
                name: data.user.name,
                phone: data.user.phone,
                tariff: data.tariff.name 
            }
            this.setProfile(obj)
            this.$router.push('/profile')
        },
        sendForm() {
            if(this.validForm()) {
                console.log('valid');
                let action = 'user/login/login_ajax'
                let method = 'post'
                let json = {
                    email_phone: this.form.email.value,
                    password: this.form.password.value
                }
                let formdata = JSON.stringify(json)
                Vue.http[method](action, formdata)
                    .then(response => response.json())
                    .then(data => {
                        if(!data.success) {
                            console.log('here', data.err.password);
                            this.error = data.err.password
                        } else {
                            this.setProfileMethod(data.data)
                        }
                    }, data => {
                })
            }
        },
        toRequest() {
            this.showModal(
                {
                    name: 'request',
                    message: this.tariffsOptions[0].name,
                    list: this.tariffsOptions
                }
            )
        }
    },
}
</script>

<style lang="sass" scoped>
@import '~@styles/pages/authorization.sass'
</style>